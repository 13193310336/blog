---
title: jsonRpc
date: '2019-11-22 15:24'
keywords:
  - rpc
  - jsonRpc
description: jsonRpc是一种轻量级的rpc规范...
categories:
  - rpc
  - concept
tags:
  - rpc
  - jsonRpc
abbrlink: '889b044c'

---

**介绍**

jsonRpc是rpc协议的一种规范，主要定义了数据结构及其相关的处理规则，此规则允许运行在基于socket，http等诸多不同消息传输环境的同一进程中,使用json作为通信载体

**兼容性**

jsonRpc目前有两个大版本 `1.0` 和 `2.0`

主要区别是`2.0`在请求中包含`jsonrpc`字段并且值为`2.0`

我们在`2.0`的实现中应该尽量去兼容`1.0`

**请求格式**

```json
{
  "jsonrpc": "2.0", // jsonRpc协议版本 有1.0 和 2.0目前主要使用2.0
  "method": "serviceMethodName", // 调用方法名称
  "param": ["param1", "param2"], // 调用方法参数 可省略
  "id": "client00001" // 客户端唯一标识
}
```

> 注意

- 请求如果不包含`id`字段，那么此次请求将视为一个通知，所谓通知，即客户端不想关注结果，而服务端也必须不发送回复
- `param`字段如果为数组，则参数顺序必须与所调用的方法**参数顺序**一致，如果为对象，则对象的键名称必须与所调用的方法**参数名称**一致

**响应格式**

```json
{
  "jsonrpc": "2.0",
  "result": "调用结果，成功时必须返回,存在错误时必须不返回",
  "error": "错误结果，失败时必须返回,成功时必须不返回",
  "id": "必须与请求时客户端id保持一致，如果发生参数错误等错误情况，此值必须为空"
}
```

- 错误响应

```json
{
  "code": "错误类型，必须为整数",
  "message": "错误描述，尽量限定在一句话以内",
  "data": "附加错误信息，可忽略"
}
```

- 错误代码

| code             | message                    | meaning                                                    |
| ---------------- | -------------------------- | :--------------------------------------------------------- |
| -32700           | Parse error语法解析错误    | 服务端接收到无效的json。该错误发送于服务器尝试解析json文本 |
| -32600           | Invalid Request无效请求    | 发送的json不是一个有效的请求对象。                         |
| -32601           | Method not found找不到方法 | 该方法不存在或无效                                         |
| -32602           | Invalid params无效的参数   | 无效的方法参数。                                           |
| -32603           | Internal error内部错误     | JSON-RPC内部错误。                                         |
| -32000 to -32099 | Server error服务端错误     | 预留用于自定义的服务器错误。                               |

**批量调用**

将请求对象以数组方式发送，若成功则返回一个数组，但**数组顺序**不保证，客户端应该以请求id为关系去匹配结果，如果批量请求对象为一个空数组或者不合法的json字符串，则返回对象为一个**错误对象而非数组**，如果批量请求对象无需返回值，如批量通知，则服务端必须**不返回任何应答，包括空数组**
